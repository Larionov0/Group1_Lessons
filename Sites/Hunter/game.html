<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .sprite {
        height: 50px;
        width: 50px;
        display: block;
        margin: 1px;
        border-radius: 3px;
    }

    table {
        border-collapse: collapse;
    }

    td {
        padding: 0px;
    }

    #main {
        display: flex;
    }

    #interface_panel {
        background-color: rgb(238, 224, 202);
        padding: 20px;
        width: 100%;
        display: flex;
    }

    #interface_panel img {
        width: 200px;
    }

    #info {
        padding-top: 50px;
    }
</style>
<body>
    <div id='main'>
        <div id='game'></div>
        <div id='interface_panel'>
            
        </div>
    </div>
</body>
<script>
    var N = 13
    var M = 20

    Array.prototype.random_choice = function(){
        return this[Math.floor(Math.random()*this.length)];
    }
    Array.prototype.remove = function (value) {
    var index = this.indexOf(value);
        if (index > -1) {
            this.splice(index, 1);
        }
    }


    class GameObject {
        constructor(name, hp, i, j, sprite){
            this.name = name
            this.hp = hp
            this.i = i
            this.j = j
            this.sprite = sprite
        }

        move(direction){
            if (direction == 'w'){
                if (this.i != 0){
                    this.i -= 1
                }
            } else if (direction == 'a'){
                if (this.j == 0){
                    this.j = M - 1
                } else {
                    this.j -= 1
                }
            } else if (direction == 's'){
                if (this.i != N - 1){
                    this.i += 1
                }
            } else if (direction == 'd'){
                if (this.j == M - 1){
                    this.j = 0
                } else {
                    this.j += 1
                }
            }
        }

        draw(matrix){
            // Отвечает за отрисовку игрока на матрице
            matrix[this.i][this.j] = this.sprite
        }
    }

    class Chicken extends GameObject{
        constructor(name, hp, i, j, sprite='https://media.tenor.com/images/c92bbe75ae5819e5bd77db2dc1dd272c/tenor.gif'){
            super(name, hp, i, j, sprite)
        }

        make_move(animals, player){
            var dir = ['w', 'a', 's', 'd'].random_choice()
            this.move(dir)
        }
    }

    class Player extends GameObject {
        constructor(name, hp, i, j, sprite='https://i.pinimg.com/originals/d7/b3/da/d7b3da3d4b19b7f0c44673374158df0a.gif', main_weapon={}){
            super(name, hp, i, j, sprite)
            this.main_weapon = main_weapon
            this.details = 0
        }

        say_hi(){
            console.log(this.name + ': Hello! :)')
        } 

        check_if_kurka_catched(animals){
            for (var animal of animals){
                if (animal instanceof Chicken){
                    if (animal.i == this.i && animal.j == this.j){
                        this.details += 3
                        animals.remove(animal)
                        break
                    }
                }
            }
        }
    }

    function create_matrix(n=N, m=M){
        // var grass_src = 'https://i.pinimg.com/originals/fa/29/d3/fa29d32e85cbc1c6e5277b1917fbeec5.jpg'
        var grass_src = 'https://images.unsplash.com/photo-1533460004989-cef01064af7e?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1yZWxhdGVkfDd8fHxlbnwwfHx8fA%3D%3D&w=1000&q=80'
        var matrix = []
        var i = 0
        while (i < n) {
            var row = [];
            var j = 0
            while (j < m) {
                row.push(grass_src)
                j += 1
            }
            matrix.push(row)
            i += 1
        }
        return matrix
    }


    function draw_matrix(matrix){
        var game = document.getElementById('game')
        var table_html = '<table>'
        for (row of matrix){
            table_html += '<tr>'
            for (img_src of row){
                table_html += '<td><img class="sprite" src="' + img_src + '"></td>'
            }
            table_html += '</tr>'
        }
        table_html += '</table>'
        game.innerHTML = table_html
    }

    function draw_interface(player){
        var interface_panel = document.getElementById('interface_panel')

        var html = ''
        html += `<div id='img_place'><img src='${player.sprite}'></div>`
        html += '<div id="info"> <h3>' + player.name + '</h3>'
        html += `<p>Детали: ${player.details}</p> </div>`
        interface_panel.innerHTML = html
    }

    var player = new Player('Bob', 4, 3, 3)
    var animals = [
        new Chicken('Ryaba', 3, 5, 5),
        new Chicken('Biba', 3, 6, 5),
        new Chicken('Boba', 3, 5, 6),
    ]

    function game_cicle(){
        // не поймал ли игрок курицу
        player.check_if_kurka_catched(animals)

        // все животные ходят
        for (animal of animals){
            animal.make_move(animals, player)
        }

        player.check_if_kurka_catched(animals)

        // все отрисовываются
        var matrix = create_matrix()  // создали пустую матрицу (с травинками)
        player.draw(matrix)  // отрисовали героя
        for (animal of animals){  // перебрали всех животных
            animal.draw(matrix)  // отрисовали каждое животное
        }
        draw_matrix(matrix)  // вывели матрицу на экран в виде таблички с картинками
        draw_interface(player) // рисуем панель с интерфейсом
    }

    function onKeyPress(event) {
        if (['w', 'a', 's', 'd'].includes(event.key)){
            player.move(event.key)
            game_cicle()
        }
    }

    game_cicle()
    document.addEventListener('keypress', onKeyPress);

</script>
</html>